#+TITLE: Primary Emacs Config
#+AUTHOR: Cole Neville
#+EMAIL: primary@coleneville.com

This gets packaged into ./config.el by org-babel-eval-in-repl imported by the init.el.

* Table of Contents :toc:
- [[#initial-setup-and-configuration][Initial Setup and Configuration]]
  - [[#auto-update-installed-packages][Auto Update Installed Packages]]
  - [[#load-and-configure-modus-theme][Load and configure Modus Theme]]
  - [[#default-emacs-confiuration][Default Emacs Confiuration]]
  - [[#default-modes-setup][Default Modes Setup]]
- [[#general-editing][General Editing]]
  - [[#rainbow-delimiters][Rainbow Delimiters]]
  - [[#company-mode][Company Mode]]
  - [[#treemacs][Treemacs]]
- [[#org-mode][Org Mode]]
  - [[#enabling-table-of-contents][Enabling Table of Contents]]
  - [[#enabling-org-bullets][Enabling Org Bullets]]
- [[#which-key][Which Key]]
- [[#ace-window][Ace Window]]
- [[#magit-better-gitvc-integration][Magit (Better Git/VC Integration)]]
- [[#ledger-mode][Ledger Mode]]
- [[#package-definitions][Package Definitions]]
  - [[#main-config][Main Config]]

* Initial Setup and Configuration
** Auto Update Installed Packages

#+begin_src emacs-lisp
  (use-package auto-package-update
    :ensure t
    :commands (auto-package-update-maybe)
    :custom
    (auto-package-update-delete-old-versions t)
    (auto-package-update-hide-results t))

  (auto-package-update-maybe)
#+end_src

** Load and configure Modus Theme

#+begin_src emacs-lisp
  (use-package modus-themes
    :ensure t
    :custom
    (modus-themes-common-palette-overrides
     `((border-mode-line-active bg-mode-line-active)
       (border-mode-line-inactive bg-mode-line-inactive)))
    (modus-vivendi-palette-overrides
     `((bg-main "#161616"))))

  (load-theme 'modus-vivendi t)
#+end_src

** Default Emacs Confiuration

#+begin_src emacs-lisp
  (setq visible-bell t
        ring-bell-function 'ignore)

  (setq inhibit-startup-screen t
        inhibit-startup-message t)

  (setq display-line-numbers-minor-tick 5
        display-line-numbers-major-tick 25
        display-line-numbers-width 4)

  (setq org-support-shift-select t)
#+end_src

** Default Modes Setup

#+begin_src emacs-lisp
  (tool-bar-mode -1)
  (scroll-bar-mode -1)
  (tab-bar-mode -1)
  (line-number-mode -1)

  (menu-bar-mode 1)

  (add-hook 'prog-mode-hook 'flymake-mode)
  (add-hook 'prog-mode-hook 'display-line-numbers-mode)
#+end_src

* General Editing

** Rainbow Delimiters

** Company Mode

** Treemacs

* Org Mode
** Enabling Table of Contents

#+begin_src emacs-lisp
  (use-package toc-org
    :ensure t
    :commands (toc-org-enable)
    :hook ((org-mode . toc-org-enable)))
#+end_src

** Enabling Org Bullets

#+begin_src emacs-lisp
  (add-hook 'org-mode-hook (lambda () (org-indent-mode 1)))

  (use-package org-bullets
    :ensure t
    :commands (org-bullets-mode)
    :hook ((org-mode . (lambda () (org-bullets-mode 1)))))
#+end_src

* Which Key

#+begin_src emacs-lisp
  (use-package which-key
    :ensure t
    :commands (which-key-mode)
    :bind (("M-h" . which-key-show-top-level))
    :custom
    (which-key-idle-delay 0.5))

  (which-key-mode 1)
#+end_src

* Ace Window

#+begin_src emacs-lisp
  (use-package ace-window
    :ensure t
    :bind (("C-x S" . ace-window)))
#+end_src

* Magit (Better Git/VC Integration)

#+begin_src emacs-lisp
  (use-package magit
    :ensure t
    :commands (magit-status magit-get-current-branch)
    :custom
    (magit-display-buffer-function #'magit-display-buffer-same-window-except-diff-v1))
#+end_src

* Ledger Mode

#+begin_src emacs-lisp
  (use-package ledger-mode
    :ensure t
    :mode ("\\.ledger\\'" "\\.journal\\'")
    :hook ((ledger-mode . flymake-mode)
           (ledger-mode . display-line-numbers-mode)))
#+end_src

* Package Definitions

*** Nix Mode

#+BEGIN_SRC emacs-lisp
  (use-package nix-mode :ensure t)
#+END_SRC

*** Dockerfile Mode
#+BEGIN_SRC emacs-lisp
  (use-package dockerfile-mode :ensure t)
#+END_SRC
*** Docker Compose Mode

#+begin_src emacs-lisp
  (use-package docker-compose-mode
    :ensure t
    :commands (docker-compose-mode))
#+end_src

*** Robe (Enhanced Ruby Mode)

#+begin_src emacs-lisp
  (use-package robe
    :ensure t
    :hook (ruby-mode . robe-mode))
#+end_src

*** Rainbow Delimiters

#+begin_src emacs-lisp
  (use-package rainbow-delimiters
    :ensure t
    :hook (prog-mode . rainbow-delimiters-mode))
#+end_src

*** Company Mode (Code Completion)

#+begin_src emacs-lisp
  (use-package company
    :ensure t
    :custom
    (company-tooltip-align-annotations t)
    (company-tooltip-display 'lines)
    (company-tooltip-flip-when-above t)
    (company-tooltip-margin 3)
    (company-tooltip-maximum-width 60)
    (company-frontends '(company-pseudo-tooltip-frontend
			 company-preview-if-just-one-frontend))
    :config
    (global-company-mode))
#+end_src

*** Counsel/Ivy (Searching)

#+begin_src emacs-lisp
  (use-package counsel
    :ensure t
    :commands (ivy-mode
	       counsel-mode)
    :custom
    (ivy-dynamic-exhibit-delay-ms 250)
    :bind (("C-f" . counsel-grep)
	   ("C-s" . counsel-git-grep)))
#+end_src

*** Treemacs (Left Side Directory Tree)

#+begin_src emacs-lisp
  (use-package treemacs
    :ensure t
    :commands (treemacs)
    :custom
    (treemacs-width 45)
    :config
    (treemacs-follow-mode 1)
    (treemacs-git-commit-diff-mode 1))
#+end_src

*** Org Roam

This is not loaded in the initial load of emacs and is instead deferred to key bind.

#+begin_src emacs-lisp
  (use-package org-roam
    :ensure t
    :custom
    (org-roam-directory "~/notes")
    :commands (org-roam-setup)
    :bind (("C-c n l" . org-roam-buffer-toggle)
	   ("C-c n f" . org-roam-node-find)
	   ("C-c n i" . org-roam-node-insert))
    :config
    (org-roam-setup))
#+end_src

*** Marginalia

#+begin_src emacs-lisp
  (use-package marginalia
    :ensure t
    :config
    (marginalia-mode))
#+end_src

*** Tree Sitter

#+begin_src emacs-lisp
  (use-package tree-sitter
    :ensure t
    :config
    (global-tree-sitter-mode)
    (add-hook 'tree-sitter-after-on-hook #'tree-sitter-hl-mode))

  (use-package treesit-auto
    :ensure t
    :config
    (global-treesit-auto-mode))
#+end_src

*** Eglot

#+begin_src emacs-lisp
  (use-package eglot :ensure t)
#+end_src

*** Aphelia (Code Formatting)

#+begin_src emacs-lisp
  (use-package apheleia
    :ensure t
    :commands (apheleia-global-mode))
#+end_src

*** Terraform

#+begin_src emacs-lisp
  (use-package terraform-mode :ensure t)
#+end_src

*** Editor Config

#+begin_src emacs-lisp
  (use-package editorconfig :ensure t)
#+end_src

** Main Config

*** Setting Variables (not for packages)

#+BEGIN_SRC emacs-lisp
  ;; This is required for eglot to load in cases where the folder is not a git repo
  (add-to-list 'project-vc-extra-root-markers "tsconfig.json")
#+END_SRC

*** Enable/Disable Minor Modes

#+BEGIN_SRC emacs-lisp
  (ivy-mode 1)
  (counsel-mode 1)

  ;; Load treemacs last so ivy and counsel are setup
  (treemacs 1)
#+END_SRC

*** Keybinds

#+begin_src emacs-lisp
  (global-set-key (kbd "C-z") 'ignore)
  (global-set-key (kbd "C-x C-z") 'ignore)
#+end_src
